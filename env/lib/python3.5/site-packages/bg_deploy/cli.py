import argparse
from bg_deploy.fsm import Fsm


def main(args):

    # parse arguments
    parser = argparse.ArgumentParser(args)

    parser.add_argument("--service_name", "-s",
                        type=str,
                        help="The service name you're deploying.",
                        required=True)

    parser.add_argument("--launch_config", "-l",
                        type=str,
                        help="Optional launch configuration you'd like applied to the target ASG.")

    parser.add_argument("--canary", "-c",
                        help="Canary stage will take place",
                        action='store_true')

    parser.add_argument("--canary_elb", "-ce",
                        help="Canary ELB will be used. This ELB should be configured already",
                        action='store_true')

    parser.add_argument("--canary_timeout", '-ct',
                        type=int,
                        help="Timeout threshold for canary stage's ELB health check in seconds",
                        default=120)

    parser.add_argument("--scaleup_timeout", '-st',
                        type=int,
                        help="Timeout threshold for scaleup stage's ELB health check in seconds",
                        required=True,
                        default=120)

    parser.add_argument("--profile", '-p',
                        type=str,
                        help="The profile\env to use specified inside your aws credentials file",
                        required=True)

    parser.add_argument("--stagger", '-sa',
                        help="Staggered Scale Up will be used, must specify step",
                        action='store_true', )

    parser.add_argument("--step", '-se',
                        type=int,
                        help="Number of instances to scale during stagger deploy")

    args = parser.parse_args()


    # begin FSM
    fsm = Fsm(service_name=args.service_name, canary_timeout=args.canary_timeout, canary_elb=args.canary_elb,
              canary=args.canary, scaleup_timeout=args.scaleup_timeout, profile=args.profile, stagger=args.stagger,
              step=args.step)

    fsm.run()

main('--help')
